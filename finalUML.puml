@startuml Blackjack_Classes
' ====== Global style ======
skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam classFontSize 12
skinparam classBackgroundColor Snow
skinparam packageTitleFontSize 14
skinparam packageBackgroundColor #FAFAFA
skinparam packageBorderColor #CCCCCC
title Blackjack Project Class Diagram

' ========= Enums =========
enum GameState {
  BETTING
  DEALING
  IN_PROGRESS
  RESULTS
}

enum AccState {
  ACTIVE
  SUSPENDED
  LOCKED
}

enum Rank {
  TWO
  THREE
  FOUR
  FIVE
  SIX
  SEVEN
  EIGHT
  NINE
  TEN
  JACK
  QUEEN
  KING
  ACE
}

enum Suit {
  HEARTS
  DIAMONDS
  CLUBS
  SPADES
}

' ========= MessageType Enum =========
enum MessageType {
  RESGISTER
  LOGIN
  LOGOUT
  GAME_UPDATE
  ERROR
  OK
  BET_PLACED
  DEAL_CARDS
  RESULT
  DEPOSIT
  WITHDRAW
  PLAYER_ACTION
  JOIN_TABLE
  LEAVE_TABLE
  REQUEST_PROFILE
  DEALER_ACTION
}


' ========= Server Side =========
package "Server" as PK_Server {
  class Server {
    + main(args : String[]) : void
  }

  class LoginManager {
    + loadData() : void
    + save() : void
    + login(username : String, password : String) : Account
    + logout(account : Account) : void
    + createAccount(u : String, p : String, type : String) : Account
  }

  abstract class Account <<Serializable>> {
    - username : String
    - password : String
    - sessionActive : boolean
    - accountState : AccState
    + getUsername() : String
  }

  interface IUser

  class Player extends Account {
    - balance : double
    - bet : Bet
    + updateBalance(amount : double) : void
    + placeBet(amount : double) : void
    + hit(card : Card) : void
    + getBet() : Bet
    + getHand() : Hand
    + getHandValue() : int
  }

  class Dealer extends Account {
    - dealerID : String
    - currentTable : GameTable
    - hand : Hand
    + hit(card : Card) : boolean
    + mustHit(total : int) : boolean
    + compareHands(playerHand : Hand) : Enums.HandEval
    + getHand() : Hand
    + getHandValue() : int
  }

  class GameTable {
    - tableID : String
    - dealer : Dealer
    - players : ArrayList<Player>
    - bets : ArrayList<Bet>
    - shoe : Shoe
    - state : GameState
    + addPlayer(player : Player) : boolean
    + removePlayer(player : Player) : void
    + startRound() : boolean
    + DealInitialCards() : void
    + handlePlayerAction(username : String, action : Enums.PlayerAction) : boolean
    + evaluateHands() : void
    + resetForNextRound() : void
    + resetTable() : void
    + createSnapshotFor(requestingPlayerUsername : String) : Shared.TableSnapshot
  }

  class Shoe {
    + dealCard() : Card
  }

  class Deck

  class Card {
    + getRank() : Enums.Rank
    + getSuit() : Enums.Suit
    + getValue() : int
  }

  class Bet {
    - amount : double
    - doubled : boolean
    - outcome : Enums.BetStatus
    - settled : boolean
    - player : Player
    + calculatePayout() : double
    + isSettled() : boolean
    + setOutcome(o : Enums.BetStatus) : void
    + settle(o : Enums.BetStatus) : void
    + getAmount() : double
    + getPlayer() : Player
  }

  class Hand <<Serializable>> {
    + addCard(card : Card) : void
    + clearHand() : void
    + getValue() : int
    + getCards() : java.util.List<Card>
  }

  class UserLogger {
    + log(username : String, action : String) : void
  }

  ' Relationships
  Account <|-- Player
  Account <|-- Dealer
  GameTable o-- Dealer
  GameTable o-- Player
  GameTable *-- Shoe
  Shoe *-- Deck
  Deck *-- Card
  Player o-- Hand
  Dealer o-- Hand
  Hand *-- Card
  Bet --> Player
}

' ========= Client Side (UI + networking) =========
package "Client" as PK_Client {
  class Client {
    + login(u : String, p : String) : boolean
    + register(u : String, p : String, type : String) : boolean
    + logout() : void
    + createTable() : Shared.TableSnapshot
    + joinTable(id : String) : Shared.TableSnapshot
    + leaveTable() : void
    + requestTableState() : Shared.TableSnapshot
    + placeBet(amount : double) : void
    + sendPlayerAction(action : Enums.PlayerAction) : Shared.TableSnapshot
    + startRound() : void
    + isDealer() : boolean
    + setGUI(gui : GUI) : void
  }

  class GUI {
    + displayTable(snapshot : Shared.TableSnapshot) : void
    + showLoginScreen() : void
    + showLobby() : void
    + setClient(client : Client) : void
  }

  class Menu {
    + Menu(client : Client)
    + displayMainMenu() : void
  }
}

' ========= Message Class (Shared between Client & Server) =========
package "Message" as PK_Message {
class Message <<Serializable>> {
  - messageID : String
  - messageType : MessageType
  - sender : String
  - recipient : String
  - payload : Object
  - timestamp : LocalDateTime
  + Message(messageID : String, messageType : MessageType, sender : String, recipient : String, payload : Object, timestamp : LocalDateTime)
  + getMessageID() : String
  + getMessageType() : MessageType
  + getSender() : String
  + getRecipient() : String
  + getPayload() : Object
  + getTimestamp() : LocalDateTime
}
}


note right of Message
Immutable, Serializable for object-over-socket.
Fields set in constructor; getters only.
end note

' ========= Network boundary =========
Client ..> Message : sends/receives
Server ..> Message : sends/receives
Client ..[#3366cc].> Server : TCP Socket

' ========= Shared Views =========
package "Shared" as PK_Shared {
  class CardView <<Serializable>>
  class DealerView <<Serializable>>
  class PlayerView <<Serializable>>
  class TableSnapshot <<Serializable>>
}
PK_Server -down[#transparent]- PK_Client
PK_Client -down[#transparent]- PK_Message
PK_Message -down[#transparent]- PK_Shared
@enduml